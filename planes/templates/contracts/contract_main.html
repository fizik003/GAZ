{% extends "base.html" %}
{% load static %}

{% block content %}

    <div id="data-container">

<table border="1">
    <tr>
        <th>Наименование (предмет) договора, <br>доп соглашения к договору <br>СОДЕРЖАНИЕ РАБОТ</th>
        <th>Статья финансирования</th>
        <th>Виды деятельности</th>
        <th>Куратор</th>
        <th>Тип договора</th>
        <th>Вид договора (основной /допсоглашение)</th>
        <th>Тип закупки(конкурентная/неконкурентная ЕП, безальтернативный поставщик)</th>
        <th>Номер ППЗ АСЭЗ</th>
        <th>Состояние АСЭЗ</th>
        <th>Номер пункта Положения о закупках товаров, работ, услуг ПАО "Газпром" и Компаний Группы Газпром № 3168</th>
        <th>Статус договора</th>
        <th>Планируемая дата загрузки в АСЭЗ</th>
        <th>Фактическая дата загрузки в АСЭЗ</th>
        <th>НМЦ АСЭЗ с НДС рос.руб.</th>
        <th>Курс в АСЭЗ на дату загрузки</th>
        <th>Сумма договора в RUB с НДС</th>
        <th>Валюта договора</th>
        <th>Отклонение данных от НМЦ в АСЭЗ</th>
        <th>№КГГ</th>
        <th>Плановая сумма SAP, всего</th>
        <th>Плановая сумма SAP I кв.</th>
        <th>Плановая сумма SAP II кв.</th>
        <th>Плановая сумма SAP III кв.</th>
        <th>Плановая сумма SAP IV кв.</th>
        <th>Регистрационный № договора в SAP (№ карточки договора)</th>
        <th>Номер договора</th>
        <th>Планируемая дата заключения</th>
        <th>Фактическая дата заключения</th>
        <th>Период действия договора (с)</th>
        <th>Период действия договора (по)</th>
        <th>Контрагент по договору</th>
        <th>Сумма заключенного договора, всего без НДС</th>
        <th>Сумма заключенного договора I кв., без НДС, BYN</th>
        <th>Сумма заключенного договора II кв., без НДС, BYN</th>
        <th>Сумма заключенного договора III кв., без НДС, BYN</th>
        <th>Сумма заключенного договора IV кв., без НДС, BYN</th>
        <th>Сумма заключенного договора, всего с НДС, BYN</th>
        <th>Общая цена договора с учетом всех дополнительных соглашений<br>(Допсоглашение в реестре должно отображаться как отдельная запись!,<br> поэтому данное поле должно быть только как справочное!)</th>
        <th>Прогноз, всего</th>
        <th>Прогноз Янв</th>
        <th>Прогноз Фев</th>
        <th>Прогноз Март</th>
        <th>Прогноз Iкв</th>
        <th>Прогноз Апр</th>
        <th>Прогноз Май</th>
        <th>Прогноз Июнь</th>
        <th>Прогноз IIкв</th>
        <th>Прогноз 6 месяцев</th>
        <th>Прогноз Июль</th>
        <th>Прогноз Авг</th>
        <th>Прогноз Сент</th>
        <th>Прогноз III кв</th>
        <th>ПРОГНОЗ 9 месяцев</th>
        <th>Прогноз Окт</th>
        <th>Прогноз Нояб</th>
        <th>Прогноз Дек</th>
        <th>Прогноз IV кв</th>
        <th>Экономия по заключенному договору, всего</th>
        <th>Экономия по заключенному договору,<br>I кв</th>
        <th>Экономия по заключенному договору,<br>II кв</th>
        <th>Экономия по заключенному договору,<br>III кв</th>
        <th>Экономия по заключенному договору,<br>IV кв</th>
        <th>Факт Всего</th>
        <th>Факт Iкв</th>
        <th>Факт Янв</th>
        <th>Факт Фев</th>
        <th>Факт Март</th>
        <th>Факт IIкв</th>
        <th>Факт Апр</th>
        <th>Факт Май</th>
        <th>Факт Июнь</th>
        <th>"Плановая сумма SAP, 6 месяцев"</th>
        <th>"Факт, 6 месяцев"</th>
        <th>Факт IIIкв</th>
        <th>Факт Июль</th>
        <th>Факт Авг</th>
        <th>Факт Сент</th>
        <th>"Плановая сумма SAP,<br>9 месяцев"</th>
        <th>"Факт,<br>9 месяцев"</th>
        <th>Факт IVкв</th>
        <th>Факт Окт</th>
        <th>Факт 10 месяцев</th>
        <th>Факт Нояб</th>
        <th>Факт Дек</th>
        <th>Экономия по результатам исполнения договоров всего</th>
        <th>Экономия по результатам исполнения договоров, I квартал</th>
        <th>Экономия по результатам исполнения договоров, II квартал</th>
        <th>Экономия по результатам исполнения договоров, III квартал</th>
        <th>Экономия по результатам исполнения договоров, IV квартал</th>
        <th>Сумма средств по не заключенным договорам</th>
        <th>Абсолютная экономия по договору, всего</th>
    </tr>

    {% for con_sum in contract_and_sum %}
        <tr>
            <td><input type="checkbox" value="{{ con_sum.contract.id }}" class="contract_choice"><a href="{{ con_sum.contract.get_absolute_url }}" id="{{ con_sum.contract.id }}">{{ con_sum.contract.title }}</a></td>
            <td>{{ con_sum.contract.finance_cost }}</td>
            <td>{{ con_sum.contract.activity_form }}</td>
            <td>{{ con_sum.contract.curator }}</td>
            <td>{{ con_sum.contract.contract_type }}</td>
            <td>{{ con_sum.contract.contract_mode }}</td>
            <td>{{ con_sum.contract.purchase_type }}</td>
            <td>{{ con_sum.contract.number_ppz }}</td>
            <td>{{ con_sum.contract.stateASEZ }}</td>
            <td>{{ con_sum.contract.number_PZTRU }}</td>
            <td>{{ con_sum.contract.contract_status }}</td>
            <td>{{ con_sum.contract.plan_load_date_ASEZ }}</td>
            <td>{{ con_sum.contract.fact_load_date_ASEZ }}</td>
            <td>{{ con_sum.sum_rur.start_max_price_ASEZ_NDS.amount }}</td>
            <td>{{ con_sum.sum_rur.currency_rate_on_load_date_ASEZ_NDS.amount }}</td>
            <td>{{ con_sum.sum_rur.contract_sum_NDS_RUB.amount }}</td>
            <td>{{ con_sum.sum_rur.currency }}</td>
            <td>{{ con_sum.sum_rur.delta_data_ASEZ.amount }}</td>
            <td>{{ con_sum.contract.number_KGG }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td>{{ con_sum.sum_byn.1quart.plan_sum_SAP.amount }}</td>
            <td>{{ con_sum.sum_byn.2quart.plan_sum_SAP.amount }}</td>
            <td>{{ con_sum.sum_byn.3quart.plan_sum_SAP.amount }}</td>
            <td>{{ con_sum.sum_byn.4quart.plan_sum_SAP.amount }}</td>
            <td>{{ con_sum.contract.register_number_SAP }}</td>
            <td>{{ con_sum.contract.contract_number }}</td>
            <td>{{ con_sum.contract.plan_sign_date }}</td>
            <td>{{ con_sum.contract.fact_sign_date }}</td>
            <td>{{ con_sum.contract.start_date }}</td>
            <td>{{ con_sum.contract.end_time }}</td>
            <td>{{ con_sum.contract.counterpart }}</td>
            <td class="calc" bgcolor="red">{{ con_sum.sum_byn.contract_sum_without_NDS_BYN.amount }}</td>
            <td>{{ con_sum.sum_byn.1quart.contract_sum_without_NDS_BYN.amount }}</td>
            <td>{{ con_sum.sum_byn.2quart.contract_sum_without_NDS_BYN.amount }}</td>
            <td>{{ con_sum.sum_byn.3quart.contract_sum_without_NDS_BYN.amount }}</td>
            <td>{{ con_sum.sum_byn.4quart.contract_sum_without_NDS_BYN.amount }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td>{{ con_sum.sum_byn.jan.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.feb.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.mar.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.1quart.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.apr.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.may.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.jun.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.2quart.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.6months.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.jul.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.aug.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.sep.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.3quart.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.9months.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.oct.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.nov.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.dec.forecast_total.amount }}</td>
            <td>{{ con_sum.sum_byn.4quart.forecast_total.amount }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td>{{ con_sum.sum_byn.1quart.economy_total.amount }}</td>
            <td>{{ con_sum.sum_byn.2quart.economy_total.amount }}</td>
            <td>{{ con_sum.sum_byn.3quart.economy_total.amount }}</td>
            <td>{{ con_sum.sum_byn.4quart.economy_total.amount }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td>{{ con_sum.sum_byn.1quart.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.jan.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.feb.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.mar.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.2quart.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.apr.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.may.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.jun.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.6months.plan_sum_SAP.amount }}</td>
            <td>{{ con_sum.sum_byn.6months.fact_total.amount  }}</td>
            <td>{{ con_sum.sum_byn.3quart.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.jul.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.aug.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.sep.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.9months.plan_sum_SAP.amount }}</td>
            <td>{{ con_sum.sum_byn.9months.fact_total.amount }}q</td>
            <td>{{ con_sum.sum_byn.4quart.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.oct.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.10months.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.nov.fact_total.amount }}</td>
            <td>{{ con_sum.sum_byn.dec.fact_total.amount }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td>{{ con_sum.sum_byn.1quart.economy_contract_result }}</td>
            <td>{{ con_sum.sum_byn.2quart.economy_contract_result }}</td>
            <td>{{ con_sum.sum_byn.3quart.economy_contract_result }}</td>
            <td>{{ con_sum.sum_byn.4quart.economy_contract_result }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
            <td class="calc" bgcolor="red">{{ con_sum. }}</td>
        </tr>
    {% endfor %}
</table>
<a href="{% url 'planes:create_contract' %}">Создать договор</a>
<br>
<button class="delete_contract">Удалить контракты</button>
<button class="copy_contract">Копировать контракт</button>
<a href="{% url 'planes:deleted_contracts' %}">Уаленные контракты</a><br>
<a href="{% url 'planes:excel_parser' %}">Импортировать excel</a>

<br><br>
<div class="contract_search_div">

    <form action="">
        <input type="search" name="search_name" placeholder="Введите наименование...">
        <br>
        Период: <br>
        <input type="date" name="search_date1"> - <input type="date" name="search_date2">
        <br>

        <label for="search_fin_cost">Статья финансирования</label>
        <select id="search_fin_cost" name="search_fin_cost">
            <option value="0">---------</option>
            {% for fin_cost in all_fin_costs %}
                <option value="{{ fin_cost.id }}">{{ fin_cost }}</option>
            {% endfor %}
        </select>
        <br>
        <label for="search_curator">Куратор</label>
        <select id="search_curator" name="search_curator">
            <option value="0">---------</option>
            {% for curator in all_curators %}
                <option value="{{ curator.id }}">{{ curator }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_type">Тип договора</label>
        <select id="search_type" name="search_type">
            <option value="0">---------</option>
            {% for type in all_contract_types %}
                <option value="{{ type.id }}">{{ type }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_mode">Вид договора</label>
        <select id="search_mode" name="search_mode">
            <option value="0">---------</option>
            {% for mode in all_contract_modes %}
                <option value="{{ mode.id }}">{{ mode }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_purchase_type">Тип закупки</label>
        <select id="search_purchase_type" name="search_purchase_type">
            <option value="0">---------</option>
            {% for purchase in all_purchase_types %}
                <option value="{{ purchase.id }}">{{ purchase }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_asez">Состояние АСЭЗ</label>
        <select id="search_asez" name="search_asez">
            <option value="0">---------</option>
            {% for state in all_state_asez %}
                <option value="{{ state.id }}">{{ state }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_pztru">№ пункта положения о закупках</label>
        <select id="search_pztru" name="search_pztru">
            <option value="0">---------</option>
            {% for pztru in all_pztru %}
                <option value="{{ pztru.id }}">{{ pztru }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_cont_suatus">Статус договора</label>
        <select id="search_cont_suatus" name="search_cont_suatus">
            <option value="0">---------</option>
            {% for status in all_cont_suatus %}
                <option value="{{ status.id }}">{{ status }}</option>
            {% endfor %}
        </select>

        <br>
        <label for="search_counterpart">Контрагент</label>
        <select id="search_counterpart" name="search_counterpart">
            <option value="0">---------</option>
            {% for counterpart in all_counterparts %}
                <option value=" {{ counterpart.id }}">{{ counterpart }}</option>
            {% endfor %}
        </select>
        <br>
        <button type="submit">Найти</button>
        <a href="{% url 'planes:contracts' %}">Вернуть исходные</a>
    </form>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $('document').ready(function () {
        $('.contract_choice').on('click', function (chose) {
            console.log(this.value);
        });

        {% if 'planes:delete_contract' in perms %}
            $('.delete_contract').on('click', function (del_con) {
                let checked = [];
                $('input:checkbox:checked').each(function() {
                    checked.push($(this).val());

                });
                console.log(checked);
                $.ajax({
                    'url':'/plane/contracts/copy_contract/',
                    'data': {'contract_id':'con_id',
                            'from_ajax':'del_contract',
                            'choosed':(checked),
                            },
                    success: function (suc) {
                        console.log('success');
                    }
                });
            });
        {% endif %}

        $('.copy_contract').on('click', function (copy_con) {
            let checked = []
            $('input:checkbox:checked').each(function() {
                checked.push($(this).val());
            });
            console.log(checked.length)
            if (checked.length != 1) {
                alert('Выбрано более одного контракта для копирования');
            }
            else {
                    url_to_go = 'copy_contract/' + '?pattern_contract_id='+checked ;
                    window.location.href = url_to_go ;
            };
        });

    });
</script>

    </div>

{% endblock content %}